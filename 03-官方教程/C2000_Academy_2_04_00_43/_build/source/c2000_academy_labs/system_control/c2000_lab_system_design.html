
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>System Design Lab &#8212; C2000 Academy  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/local/font.css" />
    <link rel="stylesheet" type="text/css" href="https://www.ti.com/assets/fonts/font.css" />
    <link rel="stylesheet" type="text/css" href="https://www.ti.com/assets/style/resource-explorer.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/quizdown.js"></script>
    <script>quizdown.init({"quizdown_js": "quizdown.js", "start_on_load": true, "shuffle_answers": false, "shuffle_questions": false, "primary_color": "var(--pst-color-primary)", "secondary_color": "#DDDDDD", "text_color": "black"});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'source/c2000_academy_labs/system_control/c2000_lab_system_design';</script>
    <script src="../../../_static/quizdown.js"></script>
    <link rel="canonical" href="http://127.0.0.1:8000/source/c2000_academy_labs/system_control/c2000_lab_system_design.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="F2803x Workshop" href="../../c2000_legacy_devices/F2803x/F2803x_workshop.html" />
    <link rel="prev" title="Interprocessor Communication (IPC) Lab" href="../advanced_topics/c2000_lab_ipc.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search C2000 Academy" aria-label="Search C2000 Academy" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    

    
    
  </div>

  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article"></div>
              
              
                <article class="bd-article" role="main">
                  
                  
<div id="searchbox"></div>
                  
  <section class="tex2jax_ignore mathjax_ignore" id="system-design-lab">
<h1>System Design Lab<a class="headerlink" href="#system-design-lab" title="Permalink to this heading">#</a></h1>
<p>This lab will build on all of the different topics covered thus far. As a
comprehensive system example, this lab will use the GPIO, EPWM, ADC, DAC, and
CMPSS modules. This lab showcases the real strength of C2000 devices, as most
of the functionality of this lab is handled by the peripherals, while reducing
load on the CPU. This lab should leave the reader with a better understanding
of the capabilities and function of their C2000 device.</p>
<div class="admonition-note admonition">
<p class="admonition-title">Note:</p>
<p>This lab is the same as “Module 12- System Design” but it utilizes SysConfig
to setup all of the peripherals.</p>
</div>
<section id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this heading">#</a></h2>
<p>All solutions are available
in the directory: <code class="docutils literal notranslate"><span class="pre">[C2000Ware_Install_Path]/training/device/[device_name]</span></code>.</p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>In this lab exercise, the EPWM module is setup to output an EPWM signal with a
duty cycle that will vary based on an ADC conversion result. Specifically, we
will use the DAC to generate a signal for the ADC to sample. Using that ADC
sample value, we then calculate a new duty cycle for the EPWM signal at the end
of every ADC conversion. At the same time, a comparator will be used to monitor
the DAC output, and it will cause a one-shot trip to drive the EPWM output low
if the DAC output is above a certain threshold.</p>
<p><img alt="Introduction" src="../../../_images/DESIGN_LAB_FLOW.png" /></p>
</section>
<section id="lab-setup">
<h2>Lab Setup<a class="headerlink" href="#lab-setup" title="Permalink to this heading">#</a></h2>
<section id="hardware-setup">
<h3>Hardware Setup<a class="headerlink" href="#hardware-setup" title="Permalink to this heading">#</a></h3>
<p>You will need the following hardware for this lab:</p>
<ul class="simple">
<li><p>A C2000 controlCARD or LaunchPad with the supplied USB cable.</p></li>
<li><p>Jumper cables (2 connections).</p></li>
</ul>
<p>Use the supplied USB cable to connect your C2000 board’s USB port to the
standard USB Type-A connector in your computer. You should see some LEDs light
up on your board. In addition to powering the board, a JTAG communication link
is also established between the device and Code Composer Studio. Refer to
<a class="reference internal" href="../../c2000_get_started/c2000_getstarted.html"><span class="doc std std-doc">Getting Started</span></a> module for more
details if needed.</p>
</section>
<section id="software-setup">
<h3>Software Setup<a class="headerlink" href="#software-setup" title="Permalink to this heading">#</a></h3>
<p>The following software will need to be installed on your computer:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.ti.com/tool/CCSTUDIO-C2000">Code Composer Studio</a></p></li>
<li><p><a class="reference external" href="https://www.ti.com/tool/C2000WARE">C2000Ware</a></p></li>
</ul>
<div class="admonition-note admonition">
<p class="admonition-title">Note:</p>
<p>For this lab exercise a CCS version 11 or higher is required
as well as a C2000Ware version 4 or higher.</p>
</div>
</section>
</section>
<section id="import-empty-project">
<h2>Import Empty project<a class="headerlink" href="#import-empty-project" title="Permalink to this heading">#</a></h2>
<p>Our first task is to import an empty project to our Code Composer
Studio (CCS) workspace.
The basic instructions are as follows:</p>
<ol class="arabic simple">
<li><p>Open CCS and go to <strong>Project→Import CCS Projects</strong>. A new window should
appear. Ensure that the <strong>Select search-directory</strong> option is activated.</p></li>
<li><p>Click the <strong>Browse</strong> button and select the
<code class="docutils literal notranslate"><span class="pre">[C20000ware_Install_dir]/training/device/[device]/empty_lab</span></code>
directory.
Note that the default Windows [C20000ware_Install_dir] is <code class="docutils literal notranslate"><span class="pre">C:/ti/c2000/C2000Ware_4_xx_xx_xx</span></code>.</p></li>
<li><p>Under <strong>Discovered Projects</strong>, you should now see the
<code class="docutils literal notranslate"><span class="pre">lab_[board]_[device]</span></code> project. Select the appropriate project for either the control card or the launchpad.</p></li>
</ol>
<p><img alt="Discovered_Projects" src="../../../_images/c2000_lab_epwm_ecap_start_small4.png" /></p>
<ol class="arabic simple" start="4">
<li><p>Click <strong>Finish</strong> to import and copy the <code class="docutils literal notranslate"><span class="pre">lab_[board]_[device]</span></code> project
into your workspace.</p></li>
<li><p>Rename the project to your liking</p>
<ul class="simple">
<li><p>“Right-click on the project in Project Explorer pane”. Select ‘Rename’ from
the drop down menu and rename the project to ‘c2000_system_design_lab’ or
a name of your choosing.</p></li>
<li><p>Now click the ‘Down Arrow’ located to the left of the imported project to
expand it and select lab_main.c. Right-click on the file, and
select ‘Rename’ to rename the file to c2000_system_design_lab_main.c or a
name of your choosing.</p></li>
</ul>
</li>
</ol>
</section>
<section id="part-1-led-setup">
<h2>Part 1: LED Setup<a class="headerlink" href="#part-1-led-setup" title="Permalink to this heading">#</a></h2>
<p>We will begin this lab by setting up the LED that will be used to observe the
EPWM duty cycle change. The first step is to open up the sysconfig file within
the project (.syscfg) and add a GPIO instance.</p>
<ul class="simple">
<li><p>Select GPIO number for your device and board from the table below.</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Device</p></th>
<th class="head"><p>LaunchPad</p></th>
<th class="head"><p>controlCARD</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>F28379D</p></td>
<td><p>Pin-66 (GPIO-31)</p></td>
<td><p>Pin-66 (GPIO-31)</p></td>
</tr>
<tr class="row-odd"><td><p>F2838x</p></td>
<td><p>n/a</p></td>
<td><p>Pin-66 (GPIO-31)</p></td>
</tr>
<tr class="row-even"><td><p>F28004x</p></td>
<td><p>Pin-81 (GPIO-23)</p></td>
<td><p>Pin-99(GPIO-31)</p></td>
</tr>
<tr class="row-odd"><td><p>F28002x</p></td>
<td><p>Pin-2 (GPIO-31)</p></td>
<td><p>Pin-2 (GPIO-31)</p></td>
</tr>
<tr class="row-even"><td><p>F28003x</p></td>
<td><p>Pin-83(GPIO-22)</p></td>
<td><p>Pin-99(GPIO-31)</p></td>
</tr>
<tr class="row-odd"><td><p>F280013x</p></td>
<td><p>n/a</p></td>
<td><p>Pin-35 (GPIO-24)</p></td>
</tr>
<tr class="row-even"><td><p>F280015x</p></td>
<td><p>n/a</p></td>
<td><p>Pin-41 (GPIO-24)</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>The parameters should be filled like below.</p></li>
</ul>
<p><img alt="LED Configuration" src="../../../_images/sysconfig_led2.png" /></p>
</section>
<section id="part-2-adc-setup">
<h2>Part 2: ADC Setup<a class="headerlink" href="#part-2-adc-setup" title="Permalink to this heading">#</a></h2>
<p>Add an ADC instance within SysConfig by clicking on the (+) next to ‘ADC’. By
default the ADC resolution will be set to 12-bits. The prescalar should be
changed to fit the image below (input clock/4).</p>
<p>After expanding the view for the ‘SOC Configurations’, “SOC/EOC number 0” is
enabled. We will be using  <code class="docutils literal notranslate"><span class="pre">ADCIN4</span></code> as the ADC channel and SOC0 as the start of
conversion. The trigger for that SOC will be EPWM1 which will be linked to
ADCSOCA since we are using one of the A channels of the ADC. A sample window of
15 SYSCLK counts will be utilized for this application.</p>
<div class="admonition-note-for-f2800137x-controlcard admonition">
<p class="admonition-title">Note for F2800137x ControlCARD:</p>
<p>If using the F2800137x ControlCARD, use ADCIN2 insetad of ADCIN4. This will be
reflected in the F2800137x ControlCARD solution.</p>
</div>
<p><img alt="ADC Setup 1" src="../../../_images/sysconfig_adc_setup1.png" /></p>
<p>Lastly, looking at the interrupt configuration we need to enable <code class="docutils literal notranslate"><span class="pre">ADCINT1</span> <span class="pre">Interrupt</span></code> and setup the source to be <code class="docutils literal notranslate"><span class="pre">SOC/EOC</span> <span class="pre">number</span> <span class="pre">0</span></code>. Ensure to also
register the interrupt handlers.</p>
<p><img alt="ADC Setup 2" src="../../../_images/sysconfig_adc_setup2.png" /></p>
</section>
<section id="part-3-dac-setup">
<h2>Part 3: DAC Setup<a class="headerlink" href="#part-3-dac-setup" title="Permalink to this heading">#</a></h2>
<p>The next module we need to set up is the DAC module for devices which utilize
the DAC. For this example we will utilize <code class="docutils literal notranslate"><span class="pre">DACA</span></code> with a reference voltage of
<code class="docutils literal notranslate"><span class="pre">ADC</span> <span class="pre">VREFHI</span> <span class="pre">reference</span> <span class="pre">voltage</span></code>. Since we will utilize the DAC to generate a
reading being passed into the ADC pin we need to enable the output of the DAC
on the pin.</p>
<p><img alt="DAC Setup" src="../../../_images/sysconfig_dac_setup.png" /></p>
<div class="admonition-note admonition">
<p class="admonition-title">Note:</p>
<p>For devices that have a DAC Type 2, the gain mode needs to be set to 2. This
will appear as a SysConfig option within the DAC module. When this is done, the
<code class="docutils literal notranslate"><span class="pre">analog</span> <span class="pre">reference</span></code> within the ASYSCTL module of SysConfig’s Analog section needs to be
changed to ‘Internal’ with an <code class="docutils literal notranslate"><span class="pre">Analog</span> <span class="pre">Reference</span> <span class="pre">Voltage</span></code> of 1.65V</p>
<p><img alt="ASYSCTL" src="../../../_images/sysconfig_asysctl.png" /></p>
</div>
</section>
<section id="part-4-cmpss-setup">
<h2>Part 4: CMPSS Setup<a class="headerlink" href="#part-4-cmpss-setup" title="Permalink to this heading">#</a></h2>
<p>The Comparator Subsystem is used in order to be able to detect when we need to
send a trip signal to the EPWM module due to the ADC conversion being above a
certain threshold. We will be using <code class="docutils literal notranslate"><span class="pre">CMPSS2</span></code> since that is the CMPSS instance
that shares an input pin with ADCIN4 by default. After enabling the CMPSS, all
we have to change is setting up the compare value we will use; in this case
<code class="docutils literal notranslate"><span class="pre">2500</span></code>.</p>
<div class="admonition-note-for-f2800137x-controlcard admonition">
<p class="admonition-title">Note for F2800137x ControlCARD:</p>
<p>If using the F2800137x ControlCARD, CMPSS1 will be used instead of CMPSS2
because CMPSS1 shares a pin with ADCIN2.</p>
</div>
<p><img alt="CMPSS Setup" src="../../../_images/sysconfig_cmpss_setup.png" /></p>
</section>
<section id="part-5-epwm-setup">
<h2>Part 5: ePWM Setup<a class="headerlink" href="#part-5-epwm-setup" title="Permalink to this heading">#</a></h2>
<p>In order to route the signal from the CMPSS module to the EPWM module we need to
use the EPWM X-BAR. Add an EPWMXBAR instance by clicking on the (+) next to it within
SysConfig. Set the trip input to <code class="docutils literal notranslate"><span class="pre">TRIP4</span></code> because that is the first trip that we use
while using the EPWMXBAR. <code class="docutils literal notranslate"><span class="pre">CMPSS2</span> <span class="pre">CTRIPH</span></code> is routed through MUX 2.</p>
<div class="admonition-note-for-f2800137x-controlcard admonition">
<p class="admonition-title">Note for F2800137x ControlCARD: </p>
<p>If using the F2800137x
ControlCARD, CMPSS1 will be used instead of CMPSS2 because CMPSS1 shares a pin
with ADCIN2. Therefore ensure the mux position is 00 with CMPSS1 CTRIPH
selected.</p>
</div>
<p><img alt="EPWM XBAR Setup" src="../../../_images/sysconfig_epwmxbar.png" /></p>
<p>Once the EPWMXBAR is setup, we can begin to setup the EPWM module. For this lab,
the <code class="docutils literal notranslate"><span class="pre">High</span> <span class="pre">Speed</span> <span class="pre">Clock</span> <span class="pre">Divider</span></code> needs to be set to 1 and a <code class="docutils literal notranslate"><span class="pre">Time</span> <span class="pre">Base</span> <span class="pre">Period</span></code>
value of 1000(this is assuming the EPWMCLK is setup to be 100MHz: refer to the
dedicated EPWM lab for more EPWM details). The counter mode will be set to
<code class="docutils literal notranslate"><span class="pre">Up-Down</span> <span class="pre">Count</span> <span class="pre">Mode</span></code> in order to have a symmetric EPWM output. For a 50% duty
cycle, the Counter Compare value will be half the value of the EPWM time base
period, in this case 500.</p>
<p><img alt="EPWM Setup 1" src="../../../_images/sysconfig_epwm_setup1.png" /></p>
<p>The action qualifier submodule will be set up to change the output of the EPWM to go high
upon a CMPA up count match and down for a CMPA down count match.</p>
<p>The larger the CMPA value (TBPRD &gt; CMPA) the smaller the duty cycle, since
duty % = ON Time/ (ON Time + OFF Time)</p>
<p><img alt="ePWM Setup" src="../../../_images/ePWMSetup.png" /></p>
<p><img alt="EPWM Setup 2" src="../../../_images/sysconfig_epwm_setup2.png" /></p>
<p>The trip zone submodule will be utilized to set up the trip. We want our output
to go low whenever the trip signal occurs. Since we are only using EPWM1A, we
can set “TZA” to a <code class="docutils literal notranslate"><span class="pre">low</span> <span class="pre">voltage</span> <span class="pre">state</span></code>. Lastly, the one-shot source will be the
DCAEVT1.</p>
<p><img alt="EPWM Setup 3" src="../../../_images/sysconfig_epwm_setup3.png" /></p>
<p>Within the Digital Compare Module we need to setup <code class="docutils literal notranslate"><span class="pre">Digital</span> <span class="pre">Compare</span> <span class="pre">A</span> <span class="pre">High</span></code> as
<code class="docutils literal notranslate"><span class="pre">Trip</span> <span class="pre">4</span></code> and list the event to occur whenever the DCxH signal goes high.</p>
<p>Within the Event Trigger submodule is where the EPWM module is setup to trigger
the ADC. If you expand the <code class="docutils literal notranslate"><span class="pre">ADC</span> <span class="pre">SOC</span> <span class="pre">Trigger</span></code> window you will see the option to
enable the SOCA trigger and set it to occur when CMPA is incrementing. Every
occurrence of this will cause a trigger.</p>
<p><img alt="EPWM Setup 4" src="../../../_images/sysconfig_epwm_setup4.png" /></p>
</section>
<section id="part-6-adc-isr">
<h2>Part 6: ADC ISR<a class="headerlink" href="#part-6-adc-isr" title="Permalink to this heading">#</a></h2>
<p>The ADC ISR is where all of the calculations will be made for the control loop.
The first step is to read the conversion results of the ADC.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// ADC A Interrupt 1 ISR</span>
<span class="c1">//</span>
<span class="n">__interrupt</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">INT_myADCA_1_ISR</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Get the latest ADC conversion result</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">adcAResult</span><span class="o">=</span><span class="w"> </span><span class="n">ADC_readResult</span><span class="p">(</span><span class="n">ADCARESULT_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">ADC_SOC_NUMBER0</span><span class="p">);</span>
</pre></div>
</div>
<p>Next, we need to utilize the ADC result to calculate the new value for the
counter compare value and change the duty cycle. The formula that will be used is,
CMPA duty = TBPRD * (1- ADC Conversion Result/4095)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// Update the CMPA value according to the ADC result</span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="n">duty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adcAResult</span><span class="o">*</span><span class="n">ADC_SCALE</span><span class="p">;</span>
<span class="w">   </span><span class="n">CMPA_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EPWM_PERIOD</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">duty</span><span class="p">);</span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// Update the CMPA value with the new calculated value</span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="n">EPWM_setCounterCompareValue</span><span class="p">(</span><span class="n">myEPWM1_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">EPWM_COUNTER_COMPARE_A</span><span class="p">,</span><span class="w"> </span><span class="n">CMPA_result</span><span class="p">);</span>
</pre></div>
</div>
<p>The following part is optional in case an oscilloscope is not accessible in
order to monitor the ePWM’s output. An LED is setup to blink at a specific
rate based on the calculated duty cycle.</p>
<p>Formula for ledBlinkRate: (100-(duty)(100))100</p>
<p>Note that ledBlinkRate is actually a counter of how many interrupts are needed
before myBoardLED0_GPIO is toggled.</p>
<p>The duty cycle is calculated and then multiplied by 100 to adjust the numbers and make
sure we can see the LED blink.</p>
<p>The higher the duty cycle, the faster the LED will blink.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Calculate the LED blink rate</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">ledBlinkRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="p">(</span><span class="n">duty</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Toggle the LED based upon the duty cycle chosen</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">LED_count</span><span class="o">++</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">ledBlinkRate</span><span class="p">)</span><span class="w">               </span><span class="c1">// Toggle LED to change state</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">GPIO_togglePin</span><span class="p">(</span><span class="n">myBoardLED0_GPIO</span><span class="p">);</span><span class="w">    </span><span class="c1">// Toggle the pin</span>
<span class="w">        </span><span class="n">LED_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">                           </span><span class="c1">// Reset the counter</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Lastly, we need to acknowledge the interrupt so that we can allow for further interrupts
and check for an ADC overflow condition.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">// Clear the interrupt flag</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">ADC_clearInterruptStatus</span><span class="p">(</span><span class="n">myADCA_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">ADC_INT_NUMBER1</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Check if overflow has occurred</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nb">true</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ADC_getInterruptOverflowStatus</span><span class="p">(</span><span class="n">myADCA_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">ADC_INT_NUMBER1</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ADC_clearInterruptOverflowStatus</span><span class="p">(</span><span class="n">myADCA_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">ADC_INT_NUMBER1</span><span class="p">);</span>
<span class="w">        </span><span class="n">ADC_clearInterruptStatus</span><span class="p">(</span><span class="n">myADCA_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">ADC_INT_NUMBER1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Acknowledge the interrupt</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">Interrupt_clearACKGroup</span><span class="p">(</span><span class="n">INTERRUPT_ACK_GROUP1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="part-7-main-file-setup">
<h2>Part 7: Main File Setup<a class="headerlink" href="#part-7-main-file-setup" title="Permalink to this heading">#</a></h2>
<p>The last component to this lab is defining all of the functions and variables to
be used throughout the lab. There are four main things to initialize/declare:
Included header files, defines, global variables, and function prototypes.  The defines
include values that will not be changing throughout the program, such as the
ePWM period. Globals are variables that will be utilized
throughout the program such as the ADC result or the CMPA value. Lastly, the
function prototypes are declarations of each of the module initialization
functions as well as the ADC ISR function.</p>
<p>Remember that the DAC and LED portions are optional/device dependent.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// Included Files</span>
<span class="c1">//</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;driverlib.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;device.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;board.h&quot;</span>
<span class="c1">//</span>
<span class="c1">// Defines</span>
<span class="c1">//</span>
<span class="cp">#define EPWM_PERIOD             1000</span>
<span class="cp">#define ADC_SCALE               1/4096.0</span>
<span class="cp">#define comp_threshold          2500</span>
<span class="c1">//</span>
<span class="c1">// Globals</span>
<span class="c1">//</span>
<span class="kt">uint16_t</span><span class="w"> </span><span class="n">adcAResult</span><span class="p">;</span><span class="w">          </span><span class="c1">/// value used to store ADC conversion</span>
<span class="kt">uint16_t</span><span class="w"> </span><span class="n">CMPA_result</span><span class="p">;</span><span class="w">         </span><span class="c1">/// value used to calculate CMPA for new duty cycle value</span>
<span class="kt">uint16_t</span><span class="w"> </span><span class="n">dacVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w">       </span><span class="c1">/// value used to set the DAC output</span>
<span class="kt">uint16_t</span><span class="w"> </span><span class="n">ledBlinkRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w">   </span><span class="c1">/// initialized value for LED blink rate</span>
<span class="kt">uint16_t</span><span class="w"> </span><span class="n">LED_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">       </span><span class="c1">/// LED counter</span>
<span class="kt">float</span><span class="w"> </span><span class="n">duty</span><span class="p">;</span><span class="w">                   </span><span class="c1">/// value that holds part of the calculation for CMPA</span>
<span class="c1">//</span>
<span class="c1">// Function Prototypes</span>
<span class="c1">//</span>
<span class="n">__interrupt</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">INT_myADCA_1_ISR</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>lab_main.c</p>
<p>To set up the device, we can use the following code to initialize the
clocks, peripherals, and PIE vectors</p>
<p>Within <code class="docutils literal notranslate"><span class="pre">main()</span></code> add the following lines of code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Initialize device clock and peripherals</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">Device_init</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Disable pin locks and enable internal pullups.</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">Device_initGPIO</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Initialize PIE and clear PIE registers. Disables CPU interrupts.</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">Interrupt_initModule</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Initialize the PIE vector table with pointers to the shell Interrupt</span>
<span class="w">    </span><span class="c1">// Service Routines (ISR).</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">Interrupt_initVectorTable</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Initialize all of the required peripherals using SysConfig</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">	</span><span class="n">Board_init</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Enable Global Interrupt (INTM) and realtime interrupt (DBGM)</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">EINT</span><span class="p">;</span>
<span class="w">    </span><span class="n">ERTM</span><span class="p">;</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Start ePWM1, enabling SOCA</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">EPWM_enableADCTrigger</span><span class="p">(</span><span class="n">myEPWM1_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">EPWM_SOC_A</span><span class="p">);</span>
</pre></div>
</div>
<p>main()</p>
<p>Lastly, we need to write the functionality of the main() function. This includes
writing a value to the buffered DAC (if used), and
monitoring the one-shot trip flag. The flag is cleared whenever the trip
condition is no longer present.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Loop indefinitely</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Set the value for the DAC</span>
<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="n">DAC_setShadowValue</span><span class="p">(</span><span class="n">myDACA_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">dacVal</span><span class="p">);</span>
<span class="w">     </span><span class="c1">//</span>
<span class="w">     </span><span class="c1">// Trip flag is set when CTRIP signal is asserted</span>
<span class="w">     </span><span class="c1">//</span>
<span class="w">     </span><span class="k">if</span><span class="p">((</span><span class="n">EPWM_getTripZoneFlagStatus</span><span class="p">(</span><span class="n">myEPWM1_BASE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">EPWM_TZ_FLAG_OST</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0U</span><span class="p">)</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="c1">// Wait for comparator CTRIP to de-assert</span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="k">while</span><span class="p">((</span><span class="n">CMPSS_getStatus</span><span class="p">(</span><span class="n">myCMPSS_BASE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">CMPSS_STS_HI_FILTOUT</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0U</span><span class="p">)</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//Update DAC value in case updated during this time</span>
<span class="w">            </span><span class="n">DAC_setShadowValue</span><span class="p">(</span><span class="n">myDACA_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">dacVal</span><span class="p">);</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="c1">// Clear trip flags</span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="n">EPWM_clearTripZoneFlag</span><span class="p">(</span><span class="n">myEPWM1_BASE</span><span class="p">,</span><span class="w"> </span><span class="n">EPWM_TZ_INTERRUPT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">EPWM_TZ_FLAG_OST</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">EPWM_TZ_FLAG_DCAEVT1</span><span class="p">);</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="part-8-running-the-lab-in-ram">
<h2>Part 8: Running the lab in RAM<a class="headerlink" href="#part-8-running-the-lab-in-ram" title="Permalink to this heading">#</a></h2>
<p>The first step towards running this lab is to build the code and fix any errors.
This is done through the build icon within CCS.</p>
<div class="admonition-note admonition">
<p class="admonition-title">Note:</p>
<p>Before building the code, open the linker file [device]_generic_ram_lnk.cmd and replace the .text line with
<code class="docutils literal notranslate">&#160;&#160; <span class="pre">.text</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">:</span> <span class="pre">&amp;gt;&amp;gt;</span> <span class="pre">RAMGS0</span> <span class="pre">|</span> <span class="pre">RAMGS1,</span> <span class="pre">PAGE</span> <span class="pre">=</span> <span class="pre">1</span></code> to prevent memory issues.</p>
</div>
<p>Then, open a debug perspective and add <code class="docutils literal notranslate"><span class="pre">adcAResult</span></code>, <code class="docutils literal notranslate"><span class="pre">CMPA_result</span></code>,
<code class="docutils literal notranslate"><span class="pre">EPwm1Regs.TZFLG.OST</span></code> and <code class="docutils literal notranslate"><span class="pre">duty</span></code> to the expression windows.</p>
<div class="admonition-note admonition">
<p class="admonition-title">Note:</p>
<p>If utilizing the DAC then add “dacVal” to the expressions window as well.</p>
</div>
<p><img alt="Expressions" src="../../../_images/expression_window.png" /></p>
<p>The following step is to set up the hardware. If connecting an external voltage
input to the ADC pin, please refer to the table below for the <code class="docutils literal notranslate"><span class="pre">ADCINA4</span></code> pin
number.</p>
<p>If utilizing the DAC, then add a jumper wire to connect the <code class="docutils literal notranslate"><span class="pre">ADCINA4</span></code>
pin to the <code class="docutils literal notranslate"><span class="pre">DACA</span></code> output pin. Pin numbers are outlined in the table below.</p>
<p><strong>LaunchPad</strong></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Device</p></th>
<th class="head"><p>ADCINA4/CMPIN2 Pin</p></th>
<th class="head"><p>DACA Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>F28379D</p></td>
<td><p>69</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>F2838x</p></td>
<td><p>n/a</p></td>
<td><p>n/a</p></td>
</tr>
<tr class="row-even"><td><p>F28004x</p></td>
<td><p>46</p></td>
<td><p>70</p></td>
</tr>
<tr class="row-odd"><td><p>F28002x</p></td>
<td><p>66</p></td>
<td><p>No DAC, connect external voltage to ADC pin</p></td>
</tr>
<tr class="row-even"><td><p>F28003x</p></td>
<td><p>66</p></td>
<td><p>70</p></td>
</tr>
<tr class="row-odd"><td><p>F280013x</p></td>
<td><p>n/a</p></td>
<td><p>n/a</p></td>
</tr>
<tr class="row-even"><td><p>F280015x</p></td>
<td><p>n/a</p></td>
<td><p>n/a</p></td>
</tr>
</tbody>
</table>
<p><strong>ControlCARD</strong></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Device</p></th>
<th class="head"><p>ADCINA4/CMPIN2 Pin</p></th>
<th class="head"><p>DACA Pin</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>F28379D</p></td>
<td><p>21</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>F2838x</p></td>
<td><p>21</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>F28004x</p></td>
<td><p>21</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>F28002x</p></td>
<td><p>21</p></td>
<td><p>No DAC, connect external voltage to ADC pin</p></td>
</tr>
<tr class="row-even"><td><p>F28003x</p></td>
<td><p>17</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>F280013x</p></td>
<td><p>ADCINA2 on Pin-15</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>F280015x</p></td>
<td><p>21</p></td>
<td><p>n/a</p></td>
</tr>
</tbody>
</table>
<p>Once everything is connected, we can run the code by clicking the resume button in CCS (while still in debug mode).</p>
<p>At this point, you should see the LED blinking according to the rate of the ePWM
duty cycle or the ePWM waveform through an oscilloscope if the input voltage to
the ADC pin is below the comparator threshold of 2500 ((2500/4096)3.3 =
~2V)</p>
<p>As an example, when 1.5V is applied to the ADC pin, the expression window should look like the below:</p>
<p><img alt="Expressions Half Voltage" src="../../../_images/RAM_1_5V.png" /></p>
<p>In this example the adcAResult is 2060, which corresponds to a voltage reading of ~1.5V</p>
<p>ADC input voltage = (ADC reading/4096)VREFHI</p>
<p>ADC input voltage = (2060/4096)3V = 1.508 V</p>
<p>If using an oscilloscope to view the ePWM output, you’ll notice the output is a
50KHz output (if EPWMCLK is 100MHz) with a ~50% duty cycle (voltage range 0-3.3V in the figure below)</p>
<p><img alt="Oscilloscope Half Voltage" src="../../../_images/OSS_RAM_1_5_V.png" /></p>
<p>The new CMPA value is based on the following formula:</p>
<p>CMPA = TBPRD(1-Conversion/4096)</p>
<p>Thus, CMPA_result = 1000(1-(2060/4096))= 497</p>
<p>There will be slight fluctuations in these readings as the ADC is sampling and
re-calculating the CMPA result.</p>
<p>Now, if you increase the voltage past a reading of 2500 (<code class="docutils literal notranslate"><span class="pre">comp_threshold</span></code>) then
the EPWM one-shot trip should activate and the ePWM output A should be driven
low.</p>
<p>In this case 2634 &gt; 2500 so the EPWM outputs are driven low. You’ll also
notice that the OST flag is set to 1 in the expression window.</p>
<p>Once the input voltage goes below the comparator threshold, the one-shot trip
flag will be cleared and the ePWM will resume normal operation.</p>
<p><img alt="Expression above threshold" src="../../../_images/RAM_1_9V.png" /></p>
<p><img alt="OSS above threshold" src="../../../_images/OSS_RAM_1_9_V.png" /></p>
<p>If the DAC is being used instead of an external input voltage to the ADC, you’ll
notice similar behavior. The current value we set in the DAC module is 1000, so
the ADC should be reading close to this value when the jumper is connected
between the DACA pin and the ADC pin.</p>
<p><img alt="DAC below threshold" src="../../../_images/DAC_below_threshold.png" /></p>
<p>We can change this value in the Expressions Window by clicking on it and
changing the value. If we set it to something above the <code class="docutils literal notranslate"><span class="pre">comp_threshold</span></code> value
then the ePWM outputs will go low and the OST Flag will be set to 1.</p>
<p><img alt="DAC above threshold" src="../../../_images/DAC_above_threshold.png" /></p>
<p>You have now completed the lab. Terminate the active debug session using
the <strong>Terminate</strong> button. This will close the debugger and return Code Composer
Studio to the CCS Edit perspective view.</p>
</section>
<section id="part-9-running-the-lab-in-flash">
<h2>Part 9: Running the lab in FLASH<a class="headerlink" href="#part-9-running-the-lab-in-flash" title="Permalink to this heading">#</a></h2>
<p>The final step for this lab is executing the program in Flash. To do this we
will utilize the <code class="docutils literal notranslate"><span class="pre">FLASH</span></code> build configuration that is built into the project.
Right click on the project -&gt; Select “Build Configurations” -&gt; “Set
Active” -&gt; “CPU1_FLASH”. Detailed information for what this configuration is
changing is outlined in the following <a class="reference external" href="https://e2e.ti.com/support/microcontrollers/c2000-microcontrollers-group/c2000/f/c2000-microcontrollers-forum/878674/faq-flash---how-to-modify-an-application-from-ram-configuration-to-flash-configuration">FLASH FAQ</a></p>
<p>Now, when the “Debug” icon is clicked, the FLASH will automatically be erased
and reprogrammed with the project’s content.</p>
<p>In this case, if the DAC is being used as the source for the ADC then you will
not be able to change the value of ‘dacVal’. If you are supplying an external
voltage to the ADC input pin, then you should see the change in ePWM duty and
LED blink rate as the input voltage is changed.</p>
<p>Example of the DAC version while running the program from Flash (0-3.3V range):</p>
<p><img alt="DAC FLASH" src="../../../_images/DAC_OSS.png" /></p>
<p>If you disconnect your device from the power source and reconnect you should see
the program still executing since the program is located in FLASH.</p>
</section>
<section id="full-solution">
<h2>Full Solution<a class="headerlink" href="#full-solution" title="Permalink to this heading">#</a></h2>
<p>The full solution to this lab exercise is included as part of the C2000Ware SDK.
Import the project from <code class="docutils literal notranslate"><span class="pre">[C2000Ware_Install_Path]/training/device/[device_name]/system_design/lab_systemdesign</span></code>. Note that the
solution includes code for both the ADC and DAC, but it will still compile on
devices that do not have a buffered DAC.</p>
<hr class="docutils" />
<div class="admonition-feedback admonition">
<p class="admonition-title">Feedback</p>
<p>Please provide any feedback you may have about the content within C2000 Academy to: <a class="reference external" href="mailto:c2000_academy_feedback&#37;&#52;&#48;list&#46;ti&#46;com">c2000_academy_feedback<span>&#64;</span>list<span>&#46;</span>ti<span>&#46;</span>com</a></p>
</div>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="../advanced_topics/c2000_lab_ipc.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Interprocessor Communication (IPC) Lab</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../../c2000_legacy_devices/F2803x/F2803x_workshop.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">F2803x Workshop</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc">
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solution">
   Solution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lab-setup">
   Lab Setup
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hardware-setup">
     Hardware Setup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#software-setup">
     Software Setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-empty-project">
   Import Empty project
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-1-led-setup">
   Part 1: LED Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-2-adc-setup">
   Part 2: ADC Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-3-dac-setup">
   Part 3: DAC Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-4-cmpss-setup">
   Part 4: CMPSS Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-5-epwm-setup">
   Part 5: ePWM Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-6-adc-isr">
   Part 6: ADC ISR
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-7-main-file-setup">
   Part 7: Main File Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-8-running-the-lab-in-ram">
   Part 8: Running the lab in RAM
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-9-running-the-lab-in-flash">
   Part 9: Running the lab in FLASH
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#full-solution">
   Full Solution
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
</div>
</div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
<script async>
  async function setTheme() {
    try {
      var colorScheme = await window.parent.getTirexTheme();
      var mode = colorScheme === 'dark' ? 'dark' : 'light';
      localStorage.setItem('mode', mode);
      document.documentElement.dataset.mode = mode;
      document.documentElement.dataset.theme = colorScheme;
    } catch (error) {
      console.error('Failed to set the theme:', error);
    }
  }

  setTheme();
</script>


  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>




<script type="text/javascript">
  function extractNodeValue(url) {
    try {
      const parsedUrl = new URL(url);
      if (parsedUrl.pathname === '/tirex/explore/node') {
        const searchParams = new URLSearchParams(parsedUrl.search);
        return searchParams.get('node');
      } else {
        return null;
      }
    } catch (error) {
      console.error("Invalid URL:", error);
      return null;
    }
  }

  // Get all links on the page
  const links = document.querySelectorAll('a');

  // Get the project name and replace spaces with underscores
  var projName = "C2000 Academy";

  // Attach a click event listener to each link
  links.forEach((link) => {
    link.addEventListener('click', (event) => {
      // Prevent the default link behavior
      event.preventDefault();

      const url = link.href;
      const match = url.match(/source\/.+$/);
      const localId = match ? match[0].replace(/\.html$/, '').replace(/[\/\\\.]/g, '_').toLowerCase() : null;

      const extractedNode = extractNodeValue(url);

      if (typeof window.parent.jumpToTirexNodeOnLocal === 'function') {
        window.parent.jumpToTirexNodeOnLocal(localId, null, null, {
            throwError: true
          })
          .catch((e) => {
            if (extractedNode !== null) {
              window.parent.jumpToTirexNode(extractedNode, {
                  throwError: true
                })
                .catch((e) => {
                  window.location.href = link.href;
                })
            }
            else {
              if (url.includes("e2e.ti.com") || url.includes("dev.ti.com/gallery/view")) {
              window.open(url, "_blank")
              } else {
              window.location.href = link.href;
            }}
          })
      } else {
        window.location.href = link.href;
      }
    });
  });
</script>
  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2023, Texas Instruments.<br>

</p>

  </div>
  
</div>
  </footer>
  </body>
</html>